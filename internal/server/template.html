<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title id="markdown-title">{{ .Title }}</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    {{ if eq .Mode "dark" }}
    <link rel="stylesheet" href="/static/chroma-github-dark.css" />
    <link rel="stylesheet" href="/static/github-markdown-dark.css" />
    {{ else if eq .Mode "light" }}
    <link rel="stylesheet" href="/static/chroma-github-light.css" />
    <link rel="stylesheet" href="/static/github-markdown-light.css" />
    {{ else }}
    <link rel="stylesheet" href="/static/chroma-github-light.css" media="(prefers-color-scheme: light)" />
    <link rel="stylesheet" href="/static/github-markdown-light.css" media="(prefers-color-scheme: light)" />
    <link rel="stylesheet" href="/static/chroma-github-dark.css" media="(prefers-color-scheme: no-preference),(prefers-color-scheme: dark)" />
    <link rel="stylesheet" href="/static/github-markdown-dark.css" media="(prefers-color-scheme: no-preference),(prefers-color-scheme: dark)" />
    {{ end }}
    <link rel="stylesheet" href="/static/directory-listing.css" />

    <style>
    body {
      background-color: #0d1117;
      color: #c9d1d9;
    }

    @media (prefers-color-scheme: light) {
      body {
        background-color: #ffffff;
        color: #1f2328;
      }
    }

    .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 920px;
      margin: 0 auto;
      padding: 45px;
    }

    .copy-button {
      background-color: transparent;
      border: none;
      position: absolute;
      top: 8px;
      right: 8px;
      border-radius: 5px;
      padding: 5px;
      transition: border-width 0.2s ease;
      cursor: pointer;
    }

    .copy-button svg.copy-icon {
      stroke: #9198a1;
    }

    .copy-button svg.tick-icon {
      stroke: #3fb950;
    }

    @media (prefers-color-scheme: light) {
      .copy-button svg.copy-icon {
        stroke: #59636e;
      }
    }

    @media (max-width: 767px) {
      .markdown-body {
        padding: 15px;
      }
    }
    </style>
  </head>

  <body>
    <!-- Breadcrumb Navigation -->
    {{if .BreadcrumbItems}}
    <div class="breadcrumb-container">
      <nav class="breadcrumb">
        <a href="/">Home</a>
        {{range .BreadcrumbItems}}
        <span class="separator">›</span>
        {{if .IsCurrent}}
        <span class="current">{{.Name}}</span>
        {{else}}
        <a href="/{{.Path}}/">{{.Name}}</a>
        {{end}}
        {{end}}
      </nav>
      {{if .ShowBrowseButton}}
      <!-- Browse Files Button with Popover -->
      <div class="browse-button-container">
        <button id="browse-files-btn" class="btn-browse">
          <svg class="file-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
            <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"></path>
          </svg>
          Browse Files
        </button>

        <!-- Popover -->
        <div id="files-popover" class="files-popover" style="display: none;">
          <div class="popover-header">
            <h3>Files</h3>
            <button id="close-popover" class="close-btn">×</button>
          </div>
          <div class="popover-body">
            {{if .FileTree}}
            <div class="file-tree-popover">
              {{range .FileTree}}
              <div class="file-tree-item">
                <a href="{{if .Path}}/{{.Path}}{{if .IsDir}}/{{end}}{{else}}/{{end}}">
                  {{if .IsDir}}
                  <svg class="dir-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                    <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"></path>
                  </svg>
                  {{else}}
                  <svg class="file-icon-small" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                    <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"></path>
                  </svg>
                  {{end}}
                  <span>{{.Name}}</span>
                </a>
              </div>
              {{end}}
            </div>
            {{end}}
          </div>
        </div>
      </div>
      {{end}}
    </div>
    {{end}}

    {{if .IsDirectoryIndex}}
    <!-- Directory Index View -->
    <div class="directory-index markdown-body">
      {{if .HasReadme}}
      <div class="back-to-readme">
        <a href="/{{if .CurrentPath}}{{.CurrentPath}}/{{end}}" class="btn-back">
          <svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
            <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"></path>
          </svg>
          Back to README
        </a>
      </div>
      {{end}}

      <h1 class="directory-title">
        <svg class="folder-icon" viewBox="0 0 16 16" version="1.1" width="24" height="24" aria-hidden="true">
          <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"></path>
        </svg>
        {{if .DirectoryTitle}}{{.DirectoryTitle}}{{else}}Files{{end}}
      </h1>

      <div class="file-tree">
        {{range .FileTree}}
        <div class="file-item">
          <a href="{{if .Path}}/{{.Path}}{{if .IsDir}}/{{end}}{{else}}/{{end}}">
            {{if .IsDir}}
            <svg class="dir-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
              <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"></path>
            </svg>
            {{else}}
            <svg class="file-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
              <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"></path>
            </svg>
            {{end}}
            <span class="file-name">{{.Name}}</span>
          </a>
        </div>
        {{end}}
      </div>
    </div>
    {{else}}
    <article id="markdown-body" class="markdown-body">{{ .Body }}</article>
    {{end}}

    <script type="text/javascript">
      Param = {
        host: "{{ .Host }}", // type: string
        mode: "{{ .Mode }}", // type: string
        reload: {{ .Reload }}, // type: bool
        isDirectoryIndex: {{ .IsDirectoryIndex }}, // type: bool
      };

      MathJax = {
        tex: {
          inlineMath: [
            ['$', '$'],
            ['\\(', '\\)'],
          ],
          displayMath: [
            ['$$', '$$'],
            ['\\[', '\\]'],
          ],
        },
      };

      // Popover functionality
      document.addEventListener('DOMContentLoaded', function() {
        const browseBtn = document.getElementById('browse-files-btn');
        const popover = document.getElementById('files-popover');
        const closeBtn = document.getElementById('close-popover');

        if (browseBtn && popover) {
          browseBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            const isVisible = popover.style.display !== 'none';
            popover.style.display = isVisible ? 'none' : 'block';
          });

          if (closeBtn) {
            closeBtn.addEventListener('click', function() {
              popover.style.display = 'none';
            });
          }

          // Close popover when clicking outside
          document.addEventListener('click', function(e) {
            if (popover.style.display !== 'none' &&
                !popover.contains(e.target) &&
                e.target !== browseBtn &&
                !browseBtn.contains(e.target)) {
              popover.style.display = 'none';
            }
          });
        }
      });
    </script>
    <script type="text/javascript" src="/static/tex-mml-chtml.min.js"></script>
    <script type="text/javascript" src="/static/mermaid.min.js"></script>
    <script type="text/javascript" src="/static/script.js"></script>
  </body>

</html>
